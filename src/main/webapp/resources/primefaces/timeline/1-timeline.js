PrimeFaces.widget.Timeline=PrimeFaces.widget.DeferredWidget.extend({init:function(a){this._super(a);this.cfg=a;this.id=a.id;this.lazy=this.getBehavior("lazyload")!=null;if(this.lazy){this.min=(typeof this.cfg.opts.min!=="undefined"?this.cfg.opts.min.getTime():null);this.max=(typeof this.cfg.opts.max!=="undefined"?this.cfg.opts.max.getTime():null);this.pFactor=this.cfg.opts.preloadFactor;this.rangeLoadedEvents={start:null,end:null}}this.renderDeferred()},_render:function(){var c=PrimeFaces.getLocaleSettings();if(c){for(var b in c){this.cfg.opts[b]=c[b]}}var a=document.getElementById(this.id);this.instance=new links.Timeline(a,this.cfg.opts);this.instance.draw(this.cfg.data,null);if(this.cfg.opts.currentTime){this.instance.setCurrentTime(this.cfg.opts.currentTime)}this.bindEvents(a)},bindEvents:function(b){if(this.cfg.opts.responsive){var d=$(b).closest(".ui-layout-pane");if(d.length>0){d.on("layoutpaneonresize",$.proxy(function(){this.instance.checkResize()},this))}else{var c="resize.timeline"+PrimeFaces.escapeClientId(this.id);$(window).off(c).on(c,$.proxy(function(){this.instance.checkResize()},this))}}if(this.cfg.opts.selectable&&this.getBehavior("select")){links.events.addListener(this.instance,"select",$.proxy(function(){var f=this.getSelectedIndex();if(f<0){return}var e={params:[{name:this.id+"_eventIdx",value:f}]};this.getBehavior("select").call(this,e)},this))}if(this.cfg.opts.selectable&&this.cfg.opts.editable&&this.getBehavior("add")){links.events.addListener(this.instance,"add",$.proxy(function(){var e=this.getSelectedEvent();if(e==null){return}var f=[];f.push({name:this.id+"_startDate",value:e.start.getTime()});if(e.end){f.push({name:this.id+"_endDate",value:e.end.getTime()})}if(e.group){f.push({name:this.id+"_group",value:e.group})}this.getBehavior("add").call(this,{params:f})},this))}if(this.cfg.opts.selectable&&this.cfg.opts.editable&&this.cfg.opts.timeChangeable&&this.getBehavior("change")){links.events.addListener(this.instance,"change",$.proxy(function(){var e=this.getSelectedIndex();if(e<0){return}var f=this.getEvent(e);if(f==null){return}if(!this.instance.isEditable(f)){return}var g=[];g.push({name:this.id+"_eventIdx",value:e});g.push({name:this.id+"_startDate",value:f.start.getTime()});if(f.end){g.push({name:this.id+"_endDate",value:f.end.getTime()})}if(f.group){g.push({name:this.id+"_group",value:f.group})}this.getBehavior("change").call(this,{params:g})},this))}if(this.cfg.opts.selectable&&this.cfg.opts.editable&&this.cfg.opts.timeChangeable&&this.getBehavior("changed")){links.events.addListener(this.instance,"changed",$.proxy(function(){var e=this.getSelectedIndex();if(e<0){return}var f=this.getEvent(e);if(f==null){return}if(!this.instance.isEditable(f)){return}var g=[];g.push({name:this.id+"_eventIdx",value:e});g.push({name:this.id+"_startDate",value:f.start.getTime()});if(f.end){g.push({name:this.id+"_endDate",value:f.end.getTime()})}if(f.group){g.push({name:this.id+"_group",value:f.group})}this.getBehavior("changed").call(this,{params:g})},this))}if(this.cfg.opts.selectable&&this.cfg.opts.editable&&this.getBehavior("edit")){links.events.addListener(this.instance,"edit",$.proxy(function(){var f=this.getSelectedIndex();if(f<0){return}if(!this.isEditable(f)){return}var e={params:[{name:this.id+"_eventIdx",value:f}]};this.getBehavior("edit").call(this,e)},this))}if(this.cfg.opts.selectable&&this.cfg.opts.editable&&this.getBehavior("delete")){links.events.addListener(this.instance,"delete",$.proxy(function(){var f=this.getSelectedIndex();if(f<0){return}if(!this.isEditable(f)){return}var e={params:[{name:this.id+"_eventIdx",value:f}]};this.getBehavior("delete").call(this,e)},this))}if((this.cfg.opts.zoomable||this.cfg.opts.moveable)&&this.getBehavior("rangechange")){links.events.addListener(this.instance,"rangechange",$.proxy(function(){var e=this.instance.getVisibleChartRange();var f={params:[{name:this.id+"_startDate",value:e.start.getTime()},{name:this.id+"_endDate",value:e.end.getTime()}]};this.getBehavior("rangechange").call(this,f)},this))}if((this.cfg.opts.zoomable||this.cfg.opts.moveable)&&this.getBehavior("rangechanged")){links.events.addListener(this.instance,"rangechanged",$.proxy(function(){var e=this.instance.getVisibleChartRange();var f={params:[{name:this.id+"_startDate",value:e.start.getTime()},{name:this.id+"_endDate",value:e.end.getTime()}]};this.getBehavior("rangechanged").call(this,f)},this))}if(this.lazy){this.fireLazyLoading();links.events.addListener(this.instance,"rangechanged",$.proxy(function(){this.fireLazyLoading()},this))}if(this.cfg.opts.selectable&&this.cfg.opts.editable&&this.getBehavior("drop")){var a={tolerance:"pointer"};if(this.cfg.opts.hoverClass){a.hoverClass=this.cfg.opts.hoverClass}if(this.cfg.opts.activeClass){a.activeClass=this.cfg.opts.activeClass}if(this.cfg.opts.accept){a.accept=this.cfg.opts.accept}if(this.cfg.opts.scope){a.scope=this.cfg.opts.scope}a.drop=$.proxy(function(m,j){var g=this.getInstance();var k=m.pageX-links.Timeline.getAbsoluteLeft(g.dom.content);var i=m.pageY-links.Timeline.getAbsoluteTop(g.dom.content);var n=g.screenToTime(k);var e=g.screenToTime(k+g.size.frameWidth/10);if(this.cfg.opts.snapEvents){g.step.snap(n);g.step.snap(e)}var f=[];f.push({name:this.id+"_startDate",value:n.getTime()});f.push({name:this.id+"_endDate",value:e.getTime()});var l=g.getGroupFromHeight(i);if(l){f.push({name:this.id+"_group",value:g.getGroupName(l)})}f.push({name:this.id+"_dragId",value:j.draggable.attr("id")});var h=j.draggable.closest(".ui-datatable, .ui-datagrid, .ui-datalist, .ui-carousel");if(h.length>0){f.push({name:this.id+"_uiDataId",value:h.attr("id")})}this.getBehavior("drop").call(this,{params:f,event:m,ui:j})},this);$(b).droppable(a)}},getData:function(){var a=$.map(this.instance.getData(),$.proxy(function(c){var b={};if(c.hasOwnProperty("content")){b.data=c.content}if(c.hasOwnProperty("start")){b.startDate=c.start.getTime()}if(c.hasOwnProperty("end")&&(c.end!=null)){b.endDate=c.end.getTime()}else{b.endDate=null}if(c.hasOwnProperty("editable")){b.editable=c.editable}else{b.editable=null}if(c.hasOwnProperty("group")){b.group=c.group}else{b.group=null}if(c.hasOwnProperty("className")){b.styleClass=c.className}else{b.styleClass=null}return b},this));return JSON.stringify(a)},fireLazyLoading:function(){var a=this.getLazyLoadRange();if(a==null){return}var b={params:[]};if(a.startFirst!=null&&a.endFirst!=null){b.params[0]={name:this.id+"_startDateFirst",value:a.startFirst};b.params[1]={name:this.id+"_endDateFirst",value:a.endFirst}}if(a.startSecond!=null&&a.endSecond!=null){b.params[2]={name:this.id+"_startDateSecond",value:a.startSecond};b.params[3]={name:this.id+"_endDateSecond",value:a.endSecond}}this.getBehavior("lazyload").call(this,b)},getLazyLoadRange:function(){var b=this.instance.getVisibleChartRange();if(this.rangeLoadedEvents.start==null||this.rangeLoadedEvents.end==null){var d=(b.end.getTime()-b.start.getTime())*this.pFactor;this.rangeLoadedEvents.start=Math.round(b.start.getTime()-d);this.rangeLoadedEvents.end=Math.round(b.end.getTime()+d);if(this.min!=null&&this.rangeLoadedEvents.start<this.min){this.rangeLoadedEvents.start=this.min}if(this.max!=null&&this.rangeLoadedEvents.end>this.max){this.rangeLoadedEvents.end=this.max}return{startFirst:this.rangeLoadedEvents.start,endFirst:this.rangeLoadedEvents.end,startSecond:null,endSecond:null}}if((b.end.getTime()>this.rangeLoadedEvents.end)&&(b.start.getTime()>=this.rangeLoadedEvents.start)){var g=this.rangeLoadedEvents.end+1;this.rangeLoadedEvents.end=Math.round(b.end.getTime()+(b.end.getTime()-b.start.getTime())*this.pFactor);if(this.max!=null&&this.rangeLoadedEvents.end>this.max){this.rangeLoadedEvents.end=this.max}return{startFirst:g,endFirst:this.rangeLoadedEvents.end,startSecond:null,endSecond:null}}if((b.start.getTime()<this.rangeLoadedEvents.start)&&(b.end.getTime()<=this.rangeLoadedEvents.end)){var f=this.rangeLoadedEvents.start-1;this.rangeLoadedEvents.start=Math.round(b.start.getTime()-(b.end.getTime()-b.start.getTime())*this.pFactor);if(this.min!=null&&this.rangeLoadedEvents.start<this.min){this.rangeLoadedEvents.start=this.min}return{startFirst:this.rangeLoadedEvents.start,endFirst:f,startSecond:null,endSecond:null}}if((b.start.getTime()<this.rangeLoadedEvents.start)&&(b.end.getTime()>this.rangeLoadedEvents.end)){var a=(b.end.getTime()-b.start.getTime())*this.pFactor;var e=this.rangeLoadedEvents.start-1;var c=this.rangeLoadedEvents.end+1;this.rangeLoadedEvents.start=Math.round(b.start.getTime()-a);this.rangeLoadedEvents.end=Math.round(b.end.getTime()+a);if(this.min!=null&&this.rangeLoadedEvents.start<this.min){this.rangeLoadedEvents.start=this.min}if(this.max!=null&&this.rangeLoadedEvents.end>this.max){this.rangeLoadedEvents.end=this.max}return{startFirst:this.rangeLoadedEvents.start,endFirst:e,startSecond:c,endSecond:this.rangeLoadedEvents.end}}return null},addEvent:function(a){this.instance.addItem(a)},changeEvent:function(a,b){this.instance.changeItem(a,b)},deleteEvent:function(a,b){this.instance.deleteItem(a,b)},deleteAllEvents:function(){this.instance.deleteAllItems()},cancelAdd:function(){this.instance.cancelAdd()},cancelChange:function(){this.instance.cancelChange()},cancelDelete:function(){this.instance.cancelDelete()},getEvent:function(a){return this.instance.getItem(a)},isEditable:function(a){return this.instance.isEditable(this.getEvent(a))},getVisibleRange:function(){return this.instance.getVisibleChartRange()},setVisibleRange:function(b,a){return this.instance.setVisibleChartRange(b,a)},move:function(a){return this.instance.move(a)},zoom:function(a,b){return this.instance.zoom(a,b)},checkResize:function(){this.instance.checkResize()},getNumberOfEvents:function(){return this.instance.getData().length},getBehavior:function(a){return this.cfg.behaviors?this.cfg.behaviors[a]:null},getSelectedIndex:function(){var a=this.instance.getSelection();if(a.length){if(a[0].row!=undefined){return a[0].row}}return -1},getSelectedEvent:function(){var a=this.getSelectedIndex();if(a!=-1){return this.instance.getItem(a)}return null},setSelection:function(a){if(a>=0){this.instance.setSelection([{row:a}])}else{this.instance.setSelection([])}},getInstance:function(){return this.instance}});